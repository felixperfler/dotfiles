#!/bin/bash
# Sync Helix theme with Ghostty theme based on system appearance (macOS)

# Detect system theme (macOS)
detect_system_theme() {
    if command -v defaults &> /dev/null; then
        local appearance=$(defaults read -g AppleInterfaceStyle 2>/dev/null)
        if [[ "$appearance" == "Dark" ]]; then
            echo "dark"
        else
            echo "light"
        fi
    else
        echo "dark"
    fi
}

# Get the corresponding Helix theme for the system theme
get_helix_theme() {
    local system_theme=$(detect_system_theme)

    case "$system_theme" in
        dark)
            echo "modus_vivendi"
            ;;
        light)
            echo "modus_operandi_tinted"
            ;;
        *)
            echo "modus_vivendi"
            ;;
    esac
}

# Update Helix theme
update_helix_theme() {
    local helix_theme=$(get_helix_theme)
    local helix_config="$HOME/.config/helix/config.toml"

    if [[ -f "$helix_config" ]]; then
        # Replace the theme line in helix config
        sed -i '' "s/^theme = .*/theme = \"$helix_theme\"/" "$helix_config"
    fi
}

# Run the update
update_helix_theme
